openapi: 3.0.3
info:
  title: Three D PC API
  description: PC 부품 견적 생성 및 관리 API
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.example.com
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Auth
    description: 인증 관련 API
  - name: Profile
    description: 사용자 프로필 관리
  - name: Products
    description: 상품 관리 API
  - name: Categories
    description: 카테고리 관리 API
  - name: Quotes
    description: 견적서 관리 API
  - name: Compatibility
    description: 호환성 검사 API
  - name: Comments
    description: 댓글 관리 API
  - name: Likes
    description: 좋아요 관리 API
  - name: Admin
    description: 관리자 전용 API

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: 서버 상태 확인
      responses:
        '200':
          description: 서버가 정상 작동 중
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                    example: '2024-01-01T00:00:00.000Z'

  /api/firebase-config:
    get:
      tags:
        - Auth
      summary: Firebase 클라이언트 설정 조회
      description: 클라이언트에서 사용할 Firebase 설정 정보를 반환합니다
      responses:
        '200':
          description: Firebase 설정 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  apiKey:
                    type: string
                  authDomain:
                    type: string
                  projectId:
                    type: string
                  storageBucket:
                    type: string
                  messagingSenderId:
                    type: string
                  appId:
                    type: string
                  measurementId:
                    type: string

  /auth/kakao:
    get:
      tags:
        - Auth
      summary: 카카오 로그인 시작
      description: 카카오 OAuth 인증을 시작합니다. 브라우저에서 접속하면 카카오 로그인 페이지로 리다이렉트됩니다.
      responses:
        '302':
          description: 카카오 로그인 페이지로 리다이렉트

  /auth/kakao/callback:
    get:
      tags:
        - Auth
      summary: 카카오 로그인 콜백
      description: 카카오 OAuth 인증 후 콜백을 처리하고 JWT 토큰을 발급합니다.
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    description: JWT 액세스 토큰
                  refreshToken:
                    type: string
                    description: JWT 리프레시 토큰
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/google:
    post:
      tags:
        - Auth
      summary: Google 로그인
      description: Firebase ID 토큰을 검증하고 JWT 토큰을 발급합니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - idToken
              properties:
                idToken:
                  type: string
                  description: Firebase ID 토큰
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags:
        - Auth
      summary: Access Token 갱신
      description: Refresh Token을 사용하여 새로운 Access Token을 발급받습니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  description: JWT 리프레시 토큰
      responses:
        '200':
          description: 토큰 갱신 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags:
        - Auth
      summary: 로그아웃
      description: 로그아웃 처리
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 로그아웃 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/profile:
    get:
      tags:
        - Profile
      summary: 프로필 조회
      description: 현재 로그인한 사용자의 프로필 정보를 조회합니다.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 프로필 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/profile/{userId}:
    put:
      tags:
        - Profile
      summary: 프로필 수정
      description: 사용자 프로필을 수정합니다. 본인 또는 관리자만 수정 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nickname:
                  type: string
      responses:
        '200':
          description: 프로필 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /api/products:
    get:
      tags:
        - Products
      summary: 상품 목록 조회
      description: 상품 목록을 조회합니다. 검색, 카테고리 필터, 페이징, 정렬을 지원합니다.
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: 검색어 (상품명, 제조사)
        - name: categoryId
          in: query
          schema:
            type: integer
          description: 카테고리 ID
        - name: isActive
          in: query
          schema:
            type: boolean
            default: true
          description: 활성화 여부
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: 페이지 번호
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: 페이지당 항목 수
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [createdAt, price, viewCount, name]
            default: createdAt
          description: 정렬 기준
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: 정렬 순서
      responses:
        '200':
          description: 상품 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  products:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      tags:
        - Products
      summary: 상품 생성
      description: 새로운 상품을 생성합니다. 관리자만 가능합니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - categoryId
                - name
                - manufacturer
                - price
              properties:
                categoryId:
                  type: integer
                name:
                  type: string
                manufacturer:
                  type: string
                price:
                  type: integer
                imageUrl:
                  type: string
                isActive:
                  type: boolean
                  default: true
                specs:
                  type: array
                  items:
                    type: object
                    properties:
                      key:
                        type: string
                      value:
                        type: string
                detailInfo:
                  type: object
                  description: 상품 상세 정보 (JSON 객체)
      responses:
        '201':
          description: 상품 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /api/products/{id}:
    get:
      tags:
        - Products
      summary: 상품 상세 조회
      description: 특정 상품의 상세 정보를 조회합니다.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 상품 상세 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - Products
      summary: 상품 수정
      description: 상품 정보를 수정합니다. 관리자만 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                categoryId:
                  type: integer
                name:
                  type: string
                manufacturer:
                  type: string
                price:
                  type: integer
                imageUrl:
                  type: string
                isActive:
                  type: boolean
                specs:
                  type: array
                  items:
                    type: object
                    properties:
                      key:
                        type: string
                      value:
                        type: string
                detailInfo:
                  type: object
      responses:
        '200':
          description: 상품 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - Products
      summary: 상품 삭제
      description: 상품을 삭제합니다. 관리자만 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 상품 삭제 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Product deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/products/{id}/price-history:
    get:
      tags:
        - Products
      summary: 상품 가격 변동 내역 조회
      description: 특정 상품의 가격 변동 내역을 조회합니다.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: startDate
          in: query
          schema:
            type: string
            format: date-time
          description: 시작 날짜
        - name: endDate
          in: query
          schema:
            type: string
            format: date-time
          description: 종료 날짜
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
          description: 최대 조회 개수
      responses:
        '200':
          description: 가격 변동 내역
          content:
            application/json:
              schema:
                type: object
                properties:
                  productId:
                    type: integer
                  priceHistory:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        price:
                          type: integer
                        recordedAt:
                          type: string
                          format: date-time
                  count:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  /api/products/{id}/related:
    get:
      tags:
        - Products
      summary: 연관 상품 조회
      description: 같은 카테고리의 인기 상품을 추천합니다.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: limit
          in: query
          schema:
            type: integer
            default: 5
          description: 최대 조회 개수
      responses:
        '200':
          description: 연관 상품 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  productId:
                    type: integer
                  relatedProducts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
                  count:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  /api/products/{id}/like:
    post:
      tags:
        - Likes
      summary: 상품 좋아요 토글
      description: 상품에 좋아요를 추가하거나 취소합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 좋아요 상태 변경 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  action:
                    type: string
                    enum: [liked, unliked]
                  liked:
                    type: boolean
                  likeCount:
                    type: integer
                  like:
                    type: object
                    nullable: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/products/{id}/comments:
    get:
      tags:
        - Comments
      summary: 상품 댓글 목록 조회
      description: 특정 상품의 댓글 목록을 조회합니다.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [createdAt, updatedAt]
            default: createdAt
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: 댓글 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  comments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Comment'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags:
        - Comments
      summary: 상품 댓글 작성
      description: 상품에 댓글을 작성합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
      responses:
        '201':
          description: 댓글 작성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/categories:
    get:
      tags:
        - Categories
      summary: 카테고리 목록 조회
      description: 전체 카테고리 목록을 계층형 트리 구조로 조회합니다.
      responses:
        '200':
          description: 카테고리 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  categories:
                    type: array
                    items:
                      $ref: '#/components/schemas/CategoryTree'
                  flat:
                    type: array
                    items:
                      $ref: '#/components/schemas/Category'
    post:
      tags:
        - Categories
      summary: 카테고리 생성
      description: 새로운 카테고리를 생성합니다. 관리자만 가능합니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                parentId:
                  type: integer
                  nullable: true
      responses:
        '201':
          description: 카테고리 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /api/categories/{id}:
    put:
      tags:
        - Categories
      summary: 카테고리 수정
      description: 카테고리 정보를 수정합니다. 관리자만 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                parentId:
                  type: integer
                  nullable: true
      responses:
        '200':
          description: 카테고리 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/quotes:
    get:
      tags:
        - Quotes
      summary: 공개 견적서 목록 조회
      description: 공개된 견적서 목록을 조회합니다. 커뮤니티/랭킹 기능에서 사용됩니다.
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [createdAt, viewCount, totalPrice, likes]
            default: createdAt
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: 견적서 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  quotes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Quote'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    post:
      tags:
        - Quotes
      summary: 견적서 생성
      description: 새로운 견적서를 생성합니다. 비회원도 생성할 수 있습니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                description:
                  type: string
                items:
                  type: array
                  items:
                    type: object
                    required:
                      - productId
                    properties:
                      productId:
                        type: integer
                      quantity:
                        type: integer
                        default: 1
      responses:
        '201':
          description: 견적서 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quote'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/quotes/me:
    get:
      tags:
        - Quotes
      summary: 내 견적서 목록 조회
      description: 현재 로그인한 사용자가 만든 견적서 목록을 조회합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [createdAt, updatedAt, totalPrice]
            default: createdAt
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: 견적서 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  quotes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Quote'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/quotes/{id}:
    get:
      tags:
        - Quotes
      summary: 견적서 상세 조회
      description: 특정 견적서의 상세 정보를 조회합니다. 비공개 견적서는 본인 또는 관리자만 조회 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 견적서 상세 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quote'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - Quotes
      summary: 견적서 수정
      description: 견적서 정보를 수정합니다. 본인 또는 관리자만 수정 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                isPublic:
                  type: boolean
      responses:
        '200':
          description: 견적서 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quote'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - Quotes
      summary: 견적서 삭제
      description: 견적서를 삭제합니다. 본인 또는 관리자만 삭제 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 견적서 삭제 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Quote deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/quotes/share/{uuid}:
    get:
      tags:
        - Quotes
      summary: 공유 링크로 견적서 조회
      description: UUID를 사용하여 비회원 견적서를 조회합니다.
      parameters:
        - name: uuid
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: 견적서 상세 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quote'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/quotes/{id}/items:
    post:
      tags:
        - Quotes
      summary: 견적서에 부품 추가
      description: 견적서에 부품을 추가합니다. 본인 또는 관리자만 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - productId
              properties:
                productId:
                  type: integer
                quantity:
                  type: integer
                  default: 1
      responses:
        '201':
          description: 부품 추가 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuoteItem'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/quotes/{id}/items/{itemId}:
    put:
      tags:
        - Quotes
      summary: 견적서 부품 수량 변경
      description: 견적서 내 부품의 수량을 변경합니다. 본인 또는 관리자만 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: itemId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - quantity
              properties:
                quantity:
                  type: integer
                  minimum: 1
      responses:
        '200':
          description: 수량 변경 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuoteItem'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - Quotes
      summary: 견적서에서 부품 제거
      description: 견적서에서 부품을 제거합니다. 본인 또는 관리자만 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: itemId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 부품 제거 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Quote item deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/quotes/{id}/like:
    post:
      tags:
        - Likes
      summary: 견적서 좋아요 토글
      description: 견적서에 좋아요를 추가하거나 취소합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 좋아요 상태 변경 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  action:
                    type: string
                    enum: [liked, unliked]
                  liked:
                    type: boolean
                  likeCount:
                    type: integer
                  like:
                    type: object
                    nullable: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/quotes/{id}/comments:
    get:
      tags:
        - Comments
      summary: 견적서 댓글 목록 조회
      description: 특정 견적서의 댓글 목록을 조회합니다.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [createdAt, updatedAt]
            default: createdAt
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: 댓글 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  comments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Comment'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags:
        - Comments
      summary: 견적서 댓글 작성
      description: 견적서에 댓글을 작성합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
      responses:
        '201':
          description: 댓글 작성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/quotes/{id}/copy:
    post:
      tags:
        - Quotes
      summary: 견적서 복사
      description: 다른 사용자의 견적서를 내 견적함으로 복사합니다 (Fork 기능).
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '201':
          description: 견적서 복사 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Quote copied successfully
                  quote:
                    $ref: '#/components/schemas/Quote'
                  originalQuoteId:
                    type: integer
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/compatibility/check:
    get:
      tags:
        - Compatibility
      summary: 호환성 검사
      description: 견적서 내 부품 간 호환성을 검사합니다.
      parameters:
        - name: quoteId
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 호환성 검사 결과
          content:
            application/json:
              schema:
                type: object
                properties:
                  quoteId:
                    type: integer
                  compatible:
                    type: boolean
                  issues:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                        severity:
                          type: string
                          enum: [error, warning]
                        component1:
                          type: object
                        component2:
                          type: object
                        message:
                          type: string
                  warnings:
                    type: array
                    items:
                      type: object
                  summary:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /comments/{id}:
    delete:
      tags:
        - Comments
      summary: 댓글 삭제
      description: 댓글을 삭제합니다. 작성자 본인 또는 관리자만 삭제 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 댓글 삭제 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Comment deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /users/me/likes:
    get:
      tags:
        - Likes
      summary: 내 좋아요 목록 조회
      description: 현재 로그인한 사용자가 좋아요한 상품/견적 목록을 조회합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [product, quote, all]
            default: all
          description: 좋아요 타입 필터
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [createdAt]
            default: createdAt
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: 좋아요 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  products:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
                  quotes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Quote'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /admin/users:
    get:
      tags:
        - Admin
      summary: 사용자 목록 조회
      description: 전체 사용자 목록을 조회합니다. 관리자만 가능합니다.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 사용자 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /admin/users/{userId}/role:
    patch:
      tags:
        - Admin
      summary: 사용자 역할 변경
      description: 사용자의 역할을 변경합니다. 관리자만 가능합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: [USER, ADMIN]
      responses:
        '200':
          description: 역할 변경 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT 토큰 인증

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        nickname:
          type: string
          nullable: true
        role:
          type: string
          enum: [USER, ADMIN]
        provider:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Category:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        parentId:
          type: integer
          nullable: true
        productCount:
          type: integer
          description: 카테고리의 상품 개수

    CategoryTree:
      allOf:
        - $ref: '#/components/schemas/Category'
        - type: object
          properties:
            children:
              type: array
              items:
                $ref: '#/components/schemas/CategoryTree'

    ProductSpec:
      type: object
      properties:
        id:
          type: integer
        key:
          type: string
        value:
          type: string

    Product:
      type: object
      properties:
        id:
          type: integer
        categoryId:
          type: integer
        category:
          $ref: '#/components/schemas/Category'
        name:
          type: string
        manufacturer:
          type: string
        price:
          type: integer
        imageUrl:
          type: string
          nullable: true
        isActive:
          type: boolean
        viewCount:
          type: integer
        specs:
          type: array
          items:
            $ref: '#/components/schemas/ProductSpec'
        detailInfo:
          type: object
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    QuoteItem:
      type: object
      properties:
        id:
          type: integer
        quoteId:
          type: integer
        productId:
          type: integer
        product:
          $ref: '#/components/schemas/Product'
        quantity:
          type: integer
        priceAt:
          type: integer

    Quote:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
          nullable: true
        user:
          $ref: '#/components/schemas/User'
          nullable: true
        title:
          type: string
        description:
          type: string
          nullable: true
        totalPrice:
          type: integer
        shareUuid:
          type: string
          format: uuid
        isPublic:
          type: boolean
        viewCount:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/QuoteItem'
        _count:
          type: object
          properties:
            comments:
              type: integer
            likes:
              type: integer
            items:
              type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Comment:
      type: object
      properties:
        id:
          type: integer
        content:
          type: string
        userId:
          type: integer
        user:
          $ref: '#/components/schemas/User'
        productId:
          type: integer
          nullable: true
        quoteId:
          type: integer
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    Error:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        path:
          type: string
        status:
          type: integer
        code:
          type: string
        message:
          type: string
        details:
          type: object
          nullable: true

  responses:
    BadRequest:
      description: 잘못된 요청
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2024-01-01T00:00:00.000Z'
            path: '/api/endpoint'
            status: 400
            code: 'VALIDATION_ERROR'
            message: 'Invalid request parameters'

    Unauthorized:
      description: 인증되지 않음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2024-01-01T00:00:00.000Z'
            path: '/api/endpoint'
            status: 401
            code: 'AUTH_UNAUTHORIZED'
            message: 'Unauthorized'

    Forbidden:
      description: 권한 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2024-01-01T00:00:00.000Z'
            path: '/api/endpoint'
            status: 403
            code: 'AUTH_FORBIDDEN'
            message: 'Forbidden: insufficient permissions'

    NotFound:
      description: 리소스를 찾을 수 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2024-01-01T00:00:00.000Z'
            path: '/api/endpoint'
            status: 404
            code: 'RESOURCE_NOT_FOUND'
            message: 'Resource not found'

    InternalServerError:
      description: 서버 내부 오류
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            timestamp: '2024-01-01T00:00:00.000Z'
            path: '/api/endpoint'
            status: 500
            code: 'INTERNAL_SERVER_ERROR'
            message: 'Internal server error'

